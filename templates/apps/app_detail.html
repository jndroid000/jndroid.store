{% extends "base.html" %}
{% load static %}
{% block title %}{{ app.title }} - JN App Store{% endblock %}
{% block extra_css %}<link rel="stylesheet" href="{% static 'css/app_detail.css' %}">{% endblock %}

{% block content %}
<!-- HERO BANNER SECTION (Like Play Store) -->
<div class="app-hero">
  <div class="app-hero-container">
    <div class="app-hero-left">
      <!-- App Cover Image -->
      <div class="app-cover">
        {% if app.cover_image %}<img src="{{ app.cover_image.url }}" alt="{{ app.title }}">{% else %}{{ app.title|first|upper }}{% endif %}
      </div>

      <!-- App Info -->
      <div class="app-hero-info">
        <h1 class="app-title">{{ app.title }}</h1>
        
        <div class="app-meta">
          <span class="app-category">{{ app.category.icon }} {{ app.category.name }}</span>
          <span>by <strong>{{ app.owner.first_name|default:app.owner.username }}</strong></span>
        </div>

        <p style="color: #7f8c8d; font-size: 14px; margin: 12px 0;">
          ğŸ“¦ {{ app.size_mb|floatformat:2 }} MB â€¢ v{{ app.version|default:"1.0" }} â€¢ Updated {{ app.updated_at|date:"M d, Y" }}
        </p>

        <!-- Stats -->
        <div class="app-stats">
          <div class="app-stat">
            <span>â­</span>
            <div>
              <div class="app-stat-value">{{ app.avg_rating|default_if_none:"0"|floatformat:1 }}/5</div>
              <div class="app-stat-label">({{ reviews_count }} reviews)</div>
            </div>
          </div>
          <div class="app-stat">
            <span>â¬‡ï¸</span>
            <div>
              <div class="app-stat-value">{{ app.downloads|default:0 }}</div>
              <div class="app-stat-label">downloads</div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="app-actions">
          <a href="{% url 'apps:download' app.slug %}" class="btn btn-primary">â¬‡ Download Now</a>
          {% if user.is_authenticated %}
            <a href="{% url 'reviews:add' app.slug %}" class="btn btn-secondary">âœ Write Review</a>
          {% else %}
            <a href="{% url 'accounts:login' %}" class="btn btn-secondary">ğŸ” Login</a>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- SIDEBAR - Quick Info (Like Play Store) -->
    <div class="app-sidebar">
      <div class="info-box">
        <div class="info-box-label">File Size</div>
        <div class="info-box-value">{{ app.size_mb|floatformat:1 }}MB</div>
      </div>

      <div class="info-box">
        <div class="info-box-label">Version</div>
        <div class="info-box-value">{{ app.version|default:"1.0" }}</div>
      </div>

      <div class="info-box">
        <div class="info-box-label">Min Android</div>
        <div class="info-box-value">{{ app.min_android_version }}</div>
        <div class="info-box-subtext">API {{ app.min_api_level }}</div>
      </div>

      <div class="info-box">
        <div class="info-box-label">Target Android</div>
        <div class="info-box-value">{{ app.target_android_version }}</div>
        <div class="info-box-subtext">API {{ app.target_api_level }}</div>
      </div>

      <div class="info-box">
        <div class="info-box-label">Downloads</div>
        <div class="info-box-value">{{ app.downloads|default:0 }}</div>
      </div>

      <div class="info-box {% if app.is_free %}badge-free{% else %}badge-paid{% endif %}">
        <div class="info-box-label">Price</div>
        <div class="info-box-value">{% if app.is_free %}FREE{% else %}${{ app.price|floatformat:2 }}{% endif %}</div>
      </div>
    </div>
  </div>
</div>

<!-- MAIN CONTENT AREA -->
<div class="app-main">
  <!-- Full-width Cover Image -->
  {% if app.cover_image %}
    <img src="{{ app.cover_image.url }}" alt="{{ app.title }}" class="app-image-full">
  {% endif %}

  <!-- Content Wrapper (2 Column Layout) -->
  <div class="app-content-wrapper">
    <!-- LEFT COLUMN -->
    <div>
      <!-- About This App -->
      {% if app.description %}
        <div class="section-card featured">
          <h2 class="section-title">ğŸ“ About This App</h2>
          <p class="section-text">{{ app.description }}</p>
        </div>
      {% endif %}

      <!-- Key Features -->
      {% if app.short_description %}
        <div class="section-card">
          <h2 class="section-title">âœ¨ Key Features</h2>
          <p class="section-text">{{ app.short_description }}</p>
        </div>
      {% endif %}

      <!-- Android Requirements (Like APK Pure) -->
      <div class="section-card info">
        <h2 class="section-title">ğŸ¤– Android Requirements</h2>
        <div class="requirements-grid">
          <div class="requirement-item">
            <div class="requirement-label">Minimum Android</div>
            <div class="requirement-value">{{ app.min_android_version }}</div>
            <div class="requirement-api">API Level {{ app.min_api_level }}</div>
          </div>
          <div class="requirement-item">
            <div class="requirement-label">Target Android</div>
            <div class="requirement-value">{{ app.target_android_version }}</div>
            <div class="requirement-api">API Level {{ app.target_api_level }}</div>
          </div>
        </div>
      </div>

      <!-- Developer Information -->
      <div class="section-card developer">
        <h2 class="section-title">ğŸ‘¨â€ğŸ’» Developer Information</h2>
        <div class="dev-info-grid">
          <div class="dev-info-item">
            <span class="dev-info-label">Developer:</span>
            <span class="dev-info-value">{{ app.developer_name|default:app.owner.get_full_name|default:app.owner.username }}</span>
          </div>
          {% if app.website_url %}
            <div class="dev-info-item">
              <span class="dev-info-label">Website:</span>
              <span class="dev-info-value"><a href="{{ app.website_url }}" target="_blank">{{ app.website_url|truncatewords:3 }}</a></span>
            </div>
          {% endif %}
          {% if app.developer_email %}
            <div class="dev-info-item">
              <span class="dev-info-label">Email:</span>
              <span class="dev-info-value"><a href="mailto:{{ app.developer_email }}">{{ app.developer_email }}</a></span>
            </div>
          {% endif %}
          {% if app.support_email %}
            <div class="dev-info-item">
              <span class="dev-info-label">Support:</span>
              <span class="dev-info-value"><a href="mailto:{{ app.support_email }}">{{ app.support_email }}</a></span>
            </div>
          {% endif %}
        </div>
      </div>

      <!-- Legal & Privacy Links -->
      {% if app.privacy_policy_url or app.terms_url %}
        <div class="section-card legal">
          <h2 class="section-title">âš–ï¸ Legal</h2>
          <div style="display: flex; gap: 12px; flex-wrap: wrap;">
            {% if app.privacy_policy_url %}
              <a href="{{ app.privacy_policy_url }}" target="_blank" class="btn btn-secondary">ğŸ”’ Privacy Policy</a>
            {% endif %}
            {% if app.terms_url %}
              <a href="{{ app.terms_url }}" target="_blank" class="btn btn-secondary">ğŸ“‹ Terms</a>
            {% endif %}
          </div>
        </div>
      {% endif %}
    </div>

    <!-- RIGHT COLUMN -->
    <div>
      <!-- Statistics -->
      <div class="section-card featured">
        <h2 class="section-title">ğŸ“Š Statistics</h2>
        <div class="stats-grid">
          <div class="stat-row">
            <span class="stat-label">â­ Rating</span>
            <strong class="stat-value highlight">{{ app.avg_rating|default_if_none:"0"|floatformat:1 }}/5.0</strong>
          </div>
          <div class="stat-row">
            <span class="stat-label">ğŸ’¬ Reviews</span>
            <strong class="stat-value">{{ reviews_count }}</strong>
          </div>
          <div class="stat-row">
            <span class="stat-label">â¬‡ï¸ Downloads</span>
            <strong class="stat-value">{{ app.downloads|default:0 }}</strong>
          </div>
          <div class="stat-row">
            <span class="stat-label">ğŸ“… Published</span>
            <strong class="stat-value">{{ app.created_at|date:"M d, Y" }}</strong>
          </div>
        </div>
      </div>

      <!-- Related Apps (Like TikTok Store) -->
      {% if related_apps %}
        <div class="section-card featured">
          <h2 class="section-title">ğŸ”— Similar Apps</h2>
          <div class="related-apps-list">
            {% for related in related_apps %}
              <a href="{% url 'apps:detail' related.slug %}" class="related-app-item">
                <div class="related-app-icon">{{ related.title|first|upper }}</div>
                <div class="related-app-info">
                  <div class="related-app-title">{{ related.title }}</div>
                  <div class="related-app-meta">â­ {{ related.avg_rating|default_if_none:"0"|floatformat:1 }} â€¢ â¬‡ {{ related.downloads|default:0 }}</div>
                </div>
              </a>
            {% endfor %}
          </div>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- USER REVIEWS SECTION -->
  <div class="reviews-section">
    <h2 class="reviews-title">â­ User Reviews ({{ reviews_count }})</h2>

    {% if reviews %}
      <div class="reviews-list">
        {% for r in reviews %}
          <div class="review-card">
            <div class="review-header">
              <div class="review-user-info">
                <div class="review-username">{{ r.user.first_name|default:r.user.username }}</div>
                <div class="review-date">{{ r.created_at|date:"M d, Y" }}</div>
              </div>
              <div class="review-rating">
                <span class="review-stars">
                  {% for i in "12345" %}
                    {% if forloop.counter <= r.rating %}â­{% else %}â˜†{% endif %}
                  {% endfor %}
                </span>
                <span>{{ r.rating }}.0</span>
              </div>
            </div>
            {% if r.comment %}
              <p class="review-comment">{{ r.comment }}</p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="review-empty">
        <div class="review-empty-icon">ğŸ“</div>
        <p class="review-empty-text">No reviews yet. Be the first to review this app!</p>
        {% if user.is_authenticated %}
          <a href="{% url 'reviews:add' app.slug %}" class="btn btn-primary">âœ Write First Review</a>
        {% else %}
          <a href="{% url 'accounts:login' %}" class="btn btn-secondary">ğŸ” Login to Review</a>
        {% endif %}
      </div>
    {% endif %}
  </div>

  <!-- COPYRIGHT & LEGAL FOOTER -->
  <div class="app-footer">
    <h3 class="app-footer-title">ğŸ“‹ App Information & Copyright</h3>
    <div class="app-footer-content">
      <p>This application is listed on <strong>JN App Store</strong> and is owned/developed by <strong>{{ app.owner.get_full_name|default:app.owner.username }}</strong>. All content, features, and availability are the responsibility of the developer.</p>
      <p style="margin-top: 12px; font-size: 12px; color: #95a5a6;">By downloading and using this app, you agree to these terms:</p>
      <ul>
        <li>The app is provided for personal, non-commercial use only</li>
        <li>Redistribution, reverse engineering, or commercial use is strictly prohibited</li>
        <li>All intellectual property rights are retained by the developer</li>
        <li>The developer is not responsible for any damages or issues caused by the app</li>
        <li>For support, licensing, or inquiries, contact the developer directly</li>
      </ul>
    </div>
  </div>
</div>
{% endblock %}
