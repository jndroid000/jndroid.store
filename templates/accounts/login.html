{% extends "base.html" %}
{% load static %}
{% block title %}‡¶≤‡¶ó‡¶á‡¶® - JN App Store{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/review_form.css' %}">
<style>
  .modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    z-index: 999;
    align-items: center;
    justify-content: center;
  }
  
  .modal-overlay.active {
    display: flex;
  }
  
  .modal-content {
    background: var(--bg);
    border-radius: 20px;
    padding: 40px;
    max-width: 500px;
    width: 90%;
    border: 1px solid var(--line);
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
    animation: slideUp 0.3s ease-out;
  }
  
  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .modal-icon {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, rgba(251,113,133,0.2), rgba(251,113,133,0.1));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 24px;
    font-size: 40px;
  }
  
  .modal-title {
    font-size: 22px;
    font-weight: 600;
    color: var(--text);
    text-align: center;
    margin-bottom: 12px;
  }
  
  .modal-subtitle {
    color: var(--muted);
    text-align: center;
    font-size: 14px;
    margin-bottom: 24px;
  }
  
  .modal-email {
    background: var(--card);
    border: 1px solid var(--line);
    border-radius: 12px;
    padding: 16px;
    text-align: center;
    margin-bottom: 24px;
    color: var(--text);
    font-weight: 500;
    word-break: break-all;
  }
  
  .modal-buttons {
    display: flex;
    gap: 12px;
    flex-direction: column;
  }
  
  .modal-btn {
    padding: 12px 24px;
    border-radius: 12px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 15px;
    text-decoration: none;
    display: block;
    text-align: center;
  }
  
  .modal-btn-primary {
    background: linear-gradient(135deg, var(--brand), #4f46e5);
    color: white;
    box-shadow: 0 18px 40px rgba(124,92,255,0.25);
  }
  
  .modal-btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 20px 45px rgba(124,92,255,0.35);
  }
  
  .modal-btn-secondary {
    background: var(--card);
    color: var(--text);
    border: 1px solid var(--line);
  }
  
  .modal-btn-secondary:hover {
    background: rgba(255,255,255,0.08);
  }
  
  .modal-info {
    background: rgba(251,113,133,0.08);
    border-left: 4px solid rgba(251,113,133,0.5);
    border-radius: 8px;
    padding: 12px;
    font-size: 13px;
    color: var(--muted);
    margin-top: 20px;
    line-height: 1.6;
  }
</style>
{% endblock %}

{% block content %}
<!-- Email Verification Modal -->
{% if unverified_email %}
  <div class="modal-overlay active">
    <div class="modal-content">
      <div class="modal-icon">üìß</div>
      <div class="modal-title">‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á‡¶ï‡¶∞‡¶£ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®</div>
      <div class="modal-subtitle">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ï‡¶∞‡¶§‡ßá ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®</div>
      
      <div class="modal-email">{{ unverified_email }}</div>
      
      <div class="modal-info">
        ‚úì ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á‡¶ï‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶™‡¶æ‡¶†‡¶æ‡¶¨‡•§
      </div>
      
      <div class="modal-buttons" style="margin-top: 24px;">
        <a href="/accounts/resend-verification/?email={{ unverified_email }}" class="modal-btn modal-btn-primary">
          üì¨ ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á‡¶ï‡¶∞‡¶£ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶∞‡¶ø‡¶∏‡ßá‡¶®‡ßç‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
        </a>
        <button type="button" class="modal-btn modal-btn-secondary" onclick="document.querySelector('.modal-overlay').classList.remove('active'); document.querySelector('.login-form').style.display='block';">
          ‚Üê ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®
        </button>
      </div>
    </div>
  </div>
  <style>
    .login-form { display: none !important; }
  </style>
{% endif %}

<div class="reviewFormContainer">
  <div class="pageHeader">
    <h1>‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h1>
    <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div style="padding:14px; border-radius:12px; margin-bottom:16px; {% if 'error' in message.tags %}background:rgba(251,113,133,0.15); border:1px solid rgba(251,113,133,0.3); color:rgba(251,113,133,0.9);{% else %}background:rgba(34,197,94,0.15); border:1px solid rgba(34,197,94,0.3); color:rgba(34,197,94,0.9);{% endif %}">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <form method="post" class="reviewForm login-form">
    {% csrf_token %}

    {% if form.non_field_errors %}
      <div style="background:rgba(251,113,133,0.15); border:1px solid rgba(251,113,133,0.3); border-radius:12px; padding:14px; margin-bottom:16px; color:rgba(251,113,133,0.9);">
        {% for error in form.non_field_errors %}
          {% if error != 'UNVERIFIED_EMAIL' %}
            <p style="margin:4px 0;">{{ error|safe }}</p>
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}

    <div class="formGroup">
      <label for="username">‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶¨‡¶æ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤</label>
      <input 
        type="text" 
        id="username" 
        name="username" 
        required 
        placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶¨‡¶æ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤"
        style="width: 100%; padding: 12px; border: 1px solid var(--line); background: var(--card); border-radius: 12px; color: var(--text); font-size: 14px; transition: background .12s ease, border-color .12s ease;"
        {% if form.username.value %}value="{{ form.username.value }}"{% endif %}
        autofocus
      />
      {% if form.username.errors %}
        {% for error in form.username.errors %}
          <small style="color: var(--danger); display: block; margin-top: 4px;">‚ö†Ô∏è {{ error }}</small>
        {% endfor %}
      {% endif %}
    </div>

    <div class="formGroup">
      <label for="password">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label>
      <input 
        type="password" 
        id="password" 
        name="password" 
        required 
        placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°"
        style="width: 100%; padding: 12px; border: 1px solid var(--line); background: var(--card); border-radius: 12px; color: var(--text); font-size: 14px; transition: background .12s ease, border-color .12s ease;"
      />
      {% if form.password.errors %}
        {% for error in form.password.errors %}
          <small style="color: var(--danger); display: block; margin-top: 4px;">‚ö†Ô∏è {{ error }}</small>
        {% endfor %}
      {% endif %}
    </div>

    <div style="display: flex; gap: 12px; margin-top: 24px;">
      <button type="submit" class="btn primary" style="flex: 1; background: linear-gradient(135deg, var(--brand), #4f46e5); border-color: rgba(255,255,255,0.12); box-shadow: 0 18px 40px rgba(124,92,255,0.25);">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>

    <div style="margin-top: 16px; text-align: center;">
      <a href="{% url 'accounts:password_reset' %}" style="color: #f59e0b; text-decoration: none; font-weight: 500; font-size: 13px; display: inline-block; padding: 6px 12px;">üîë ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤‡ßá ‡¶ó‡ßá‡¶õ‡ßá‡¶®?</a>
    </div>

    <div style="margin-top: 16px; text-align: center; color: var(--muted); font-size: 14px;">
      ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á? <a href="{% url 'accounts:signup' %}" style="color: var(--brand); text-decoration: underline;">‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®</a>
    </div>
  </form>
</div>
{% endblock %}
