{% extends "base.html" %}
{% load static %}
{% block title %}Apps Management - Admin{% endblock %}

{% block content %}
<div style="padding:20px;">
  <!-- Header -->
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:32px;">
    <div>
      <h1 style="margin:0 0 8px; font-size:32px;">Apps Management</h1>
      <p style="color:var(--muted);">Total: {{ total_apps }} apps | Published: {{ published_count }} | Draft: {{ draft_count }}</p>
    </div>
    <div style="display:flex; gap:12px;">
      <a href="{% url 'apps:upload' %}" class="btn primary" style="padding:10px 20px;">â¬†ï¸ Upload</a>
      <a href="{% url 'admin_panel:dashboard' %}" class="btn secondary" style="padding:10px 20px;">â† Back</a>
    </div>
  </div>

  <!-- Filter/Search -->
  <form method="GET" style="margin-bottom:20px; display:flex; gap:12px; align-items:flex-end;">
    <div style="flex:1;">
      <label style="display:block; margin-bottom:4px; font-size:12px; font-weight:500; color:var(--muted); text-transform:uppercase;">Search</label>
      <input type="text" name="q" placeholder="App name, developer email, slug..." value="{{ q }}" style="width:100%; padding:10px; background:rgba(255,255,255,0.04); border:1px solid var(--line); border-radius:8px; color:var(--text); font-size:14px; box-sizing:border-box;">
    </div>
    <div style="width:200px;">
      <label style="display:block; margin-bottom:4px; font-size:12px; font-weight:500; color:var(--muted); text-transform:uppercase;">Status</label>
      <select name="status" style="width:100%; padding:10px; background:rgba(255,255,255,0.04); border:1px solid var(--line); border-radius:8px; color:var(--text); font-size:14px; box-sizing:border-box;">
        <option value="">All Status</option>
        <option value="published" {% if status == "published" %}selected{% endif %}>Published</option>
        <option value="draft" {% if status == "draft" %}selected{% endif %}>Draft</option>
      </select>
    </div>
    <button type="submit" class="btn primary" style="padding:10px 20px;">ğŸ” Search</button>
    {% if q or status %}<a href="{% url 'admin_panel:apps_list' %}" class="btn secondary" style="padding:10px 20px;">â†º Reset</a>{% endif %}
  </form>

  <!-- Apps Table -->
  <div style="overflow-x:auto; border:1px solid var(--line); border-radius:12px;">
    <table style="width:100%; border-collapse:collapse; font-size:14px;">
      <thead>
        <tr style="background:rgba(255,255,255,0.04); border-bottom:1px solid var(--line);">
          <th style="padding:12px; text-align:left; color:var(--muted); font-weight:500;">App Name</th>
          <th style="padding:12px; text-align:left; color:var(--muted); font-weight:500;">Developer</th>
          <th style="padding:12px; text-align:center; color:var(--muted); font-weight:500;">Downloads</th>
          <th style="padding:12px; text-align:center; color:var(--muted); font-weight:500;">Rating</th>
          <th style="padding:12px; text-align:center; color:var(--muted); font-weight:500;">Status</th>
          <th style="padding:12px; text-align:center; color:var(--muted); font-weight:500;">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for app in apps %}
          <tr style="border-bottom:1px solid var(--line); hover:background:rgba(255,255,255,0.02);">
            <td style="padding:12px;">
              <a href="{% url 'admin_panel:app_detail' app.slug %}" style="text-decoration:none; color:inherit;">
                <div style="font-weight:500; cursor:pointer; color:var(--primary);">{{ app.title }}</div>
                <div style="color:var(--muted); font-size:12px;">v{{ app.version }}</div>
              </a>
            </td>
            <td style="padding:12px;">
              <div>{{ app.owner.username }}</div>
              <div style="color:var(--muted); font-size:12px;">{{ app.owner.email }}</div>
            </td>
            <td style="padding:12px; text-align:center;">{{ app.downloads }}</td>
            <td style="padding:12px; text-align:center;">
              <span style="color:#fbbf24;">{% if app.avg_rating %}{{ app.avg_rating|floatformat:1 }}â­{% else %}â€”{% endif %}</span>
            </td>
            <td style="padding:12px; text-align:center;">
              {% if app.is_published %}
                <span style="padding:4px 8px; background:rgba(34,197,94,0.15); border:1px solid rgba(34,197,94,0.3); color:rgba(34,197,94,0.9); border-radius:4px; font-size:12px;">Published</span>
              {% else %}
                <span style="padding:4px 8px; background:rgba(156,163,175,0.15); border:1px solid rgba(156,163,175,0.3); color:rgba(156,163,175,0.9); border-radius:4px; font-size:12px;">Draft</span>
              {% endif %}
            </td>
            <td style="padding:12px; text-align:center;">
              <div style="display:flex; gap:6px; justify-content:center;">
                <a href="{% url 'admin_panel:app_detail' app.slug %}" class="btn secondary" style="padding:6px 10px; font-size:12px;">ğŸ“Š</a>
                <a href="{% url 'admin_panel:apps_edit' app.slug %}" class="btn secondary" style="padding:6px 10px; font-size:12px;">âœï¸</a>
                <a href="{% url 'apps:detail' app.slug %}" class="btn secondary" style="padding:6px 10px; font-size:12px;" target="_blank">ğŸ‘</a>
              </div>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="6" style="padding:32px; text-align:center; color:var(--muted);">ğŸ“­ No apps found</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  {% if apps.has_other_pages %}
    <div style="margin-top:20px; display:flex; justify-content:center; gap:8px; align-items:center;">
      {% if apps.has_previous %}
        <a href="?page=1{% if q %}&q={{ q }}{% endif %}{% if status %}&status={{ status }}{% endif %}" class="btn secondary" style="padding:6px 10px; font-size:12px;">First</a>
        <a href="?page={{ apps.previous_page_number }}{% if q %}&q={{ q }}{% endif %}{% if status %}&status={{ status }}{% endif %}" class="btn secondary" style="padding:6px 10px; font-size:12px;">â† Previous</a>
      {% endif %}
      
      <span style="padding:6px 12px; color:var(--muted); font-size:12px;">Page {{ apps.number }} of {{ apps.paginator.num_pages }}</span>
      
      {% if apps.has_next %}
        <a href="?page={{ apps.next_page_number }}{% if q %}&q={{ q }}{% endif %}{% if status %}&status={{ status }}{% endif %}" class="btn secondary" style="padding:6px 10px; font-size:12px;">Next â†’</a>
        <a href="?page={{ apps.paginator.num_pages }}{% if q %}&q={{ q }}{% endif %}{% if status %}&status={{ status }}{% endif %}" class="btn secondary" style="padding:6px 10px; font-size:12px;">Last</a>
      {% endif %}
    </div>
  {% endif %}
</div>

{% endblock %}
