{% extends "base.html" %}
{% load static %}
{% block title %}Categories Management - Admin{% endblock %}
{% block extra_css %}<link rel="stylesheet" href="{% static 'css/categories_admin.css' %}">{% endblock %}

{% block content %}
<div class="categories-container">
  <!-- Header -->
  <div class="categories-header">
    <div class="categories-header-left">
      <h1>Categories Management</h1>
      <p>Total: {{ categories|length }} categories</p>
    </div>
    <a href="{% url 'admin_panel:dashboard' %}" class="btn-dashboard">← Back to Dashboard</a>
  </div>

  <!-- Add Category Form -->
  <div class="add-category-section">
    <h3>Add New Category</h3>
    <form method="post" action="{% url 'admin_panel:categories_create' %}" class="add-category-form">
      {% csrf_token %}
      <div class="form-group">
        <label>Category Name</label>
        <input type="text" name="name" placeholder="e.g. Games" required>
      </div>
      <div class="form-group">
        <label>Description</label>
        <input type="text" name="description" placeholder="Brief description">
      </div>
      <button type="submit" class="btn-primary">Create Category</button>
    </form>
  </div>

  <!-- Categories Table -->
  <div class="table-container">
    <table class="categories-table">
      <thead>
        <tr>
          <th>Category</th>
          <th>Description</th>
          <th>Apps</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for category in categories %}
          <tr>
            <td class="category-name">{{ category.name }}</td>
            <td class="category-description">{{ category.description|default:"No description" }}</td>
            <td class="apps-count">{{ category.apps.count }}</td>
            <td class="actions-cell">
              <div class="actions-group">
                <a href="{% url 'admin_panel:categories_view' pk=category.pk %}" class="btn-action view">View</a>
                <a href="{% url 'admin_panel:categories_edit' pk=category.pk %}" class="btn-action edit">Edit</a>
                <button type="button" onclick="openDeleteModal({{ category.pk }}, '{{ category.name }}')" class="btn-action delete">Delete</button>
              </div>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="4" class="empty-state">No categories found</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal">
  <div class="modal-content">
    <!-- Icon & Title -->
    <div class="modal-icon">⚠️</div>
    <div class="modal-header">
      <h2>Delete Category?</h2>
      <p>This action cannot be undone</p>
    </div>

    <!-- Warning Message -->
    <div class="modal-warning">
      <strong id="categoryName"></strong> will be permanently deleted
    </div>

    <!-- Buttons -->
    <div class="modal-actions">
      <button type="button" onclick="closeDeleteModal()" class="btn-cancel">Cancel</button>
      <form id="deleteForm" method="post">
        {% csrf_token %}
        <button type="submit" class="btn-delete-confirm">Delete Permanently</button>
      </form>
    </div>
  </div>
</div>

<script>
var currentCategoryId = null;

function openDeleteModal(categoryId, categoryName) {
  currentCategoryId = categoryId;
  document.getElementById('categoryName').textContent = categoryName;
  
  // Set form action dynamically
  const form = document.getElementById('deleteForm');
  form.action = '/admin-panel/categories/' + categoryId + '/delete/';
  
  document.getElementById('deleteModal').classList.add('show');
}

function closeDeleteModal() {
  document.getElementById('deleteModal').classList.remove('show');
  currentCategoryId = null;
}

// Close modal when clicking outside of it
document.getElementById('deleteModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeDeleteModal();
  }
});

// Close modal with Escape key
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    closeDeleteModal();
  }
});
</script>
{% endblock %}
