{% extends "base.html" %}
{% load static %}
{% block title %}Link Management Analytics - Admin{% endblock %}
{% block extra_css %}<link rel="stylesheet" href="{% static 'css/admin_panel.css' %}">{% endblock %}

{% block content %}
<div style="padding:20px;">
  <!-- Header -->
  <div style="margin-bottom:32px;">
    <h1 style="margin:0 0 8px; font-size:32px;">ğŸ”— Link Management</h1>
    <p style="color:var(--muted);">Analytics and moderation for user links</p>
  </div>

  <!-- Stats Grid -->
  <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:16px; margin-bottom:32px;">
    <div style="padding:20px; background:rgba(59,130,246,0.1); border:1px solid rgba(59,130,246,0.2); border-radius:12px;">
      <div style="font-size:28px; font-weight:bold; color:#3b82f6;">{{ total_links }}</div>
      <div style="color:var(--muted); font-size:14px;">Total Links</div>
    </div>

    <div style="padding:20px; background:rgba(34,197,94,0.1); border:1px solid rgba(34,197,94,0.2); border-radius:12px;">
      <div style="font-size:28px; font-weight:bold; color:#22c55e;">{{ total_clicks }}</div>
      <div style="color:var(--muted); font-size:14px;">Total Clicks</div>
    </div>

    <div style="padding:20px; background:rgba(139,92,246,0.1); border:1px solid rgba(139,92,246,0.2); border-radius:12px;">
      <div style="font-size:28px; font-weight:bold; color:#8b5cf6;">{{ users_with_links }}</div>
      <div style="color:var(--muted); font-size:14px;">Active Users</div>
    </div>

    <div style="padding:20px; background:rgba(251,191,36,0.1); border:1px solid rgba(251,191,36,0.2); border-radius:12px;">
      <div style="font-size:28px; font-weight:bold; color:#fbbf24;">{{ total_categories }}</div>
      <div style="color:var(--muted); font-size:14px;">Categories</div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(220px, 1fr)); gap:16px; margin-bottom:32px;">
    <a href="{% url 'links:admin_list' %}" class="btn primary" style="padding:12px; text-align:center; text-decoration:none; border-radius:8px;">
      ğŸ“‹ Manage All Links
    </a>
    <a href="{% url 'links:admin_analytics' %}" class="btn primary" style="padding:12px; text-align:center; text-decoration:none; border-radius:8px;">
      ğŸ“Š View Analytics
    </a>
  </div>

  <!-- Most Popular Links -->
  <div style="padding:20px; background:rgba(255,255,255,0.04); border:1px solid var(--line); border-radius:12px; margin-bottom:32px;">
    <h3 style="margin:0 0 16px;">â­ Most Popular Links (Top 10)</h3>
    <div style="overflow-x:auto;">
      <table style="width:100%; border-collapse:collapse;">
        <thead>
          <tr style="border-bottom:1px solid var(--line);">
            <th style="text-align:left; padding:12px; color:var(--muted); font-size:12px; text-transform:uppercase;">Title</th>
            <th style="text-align:left; padding:12px; color:var(--muted); font-size:12px; text-transform:uppercase;">Creator</th>
            <th style="text-align:center; padding:12px; color:var(--muted); font-size:12px; text-transform:uppercase;">Clicks</th>
            <th style="text-align:center; padding:12px; color:var(--muted); font-size:12px; text-transform:uppercase;">Status</th>
          </tr>
        </thead>
        <tbody>
          {% for link in popular_links %}
            <tr style="border-bottom:1px solid rgba(255,255,255,0.05);">
              <td style="padding:12px;">
                <a href="{{ link.get_absolute_url }}" target="_blank" style="color:inherit; text-decoration:none;">
                  {{ link.title }}
                </a>
              </td>
              <td style="padding:12px; color:var(--muted);">@{{ link.user.username }}</td>
              <td style="padding:12px; text-align:center; font-weight:bold; color:#22c55e;">{{ link.click_count }}</td>
              <td style="padding:12px; text-align:center;">
                <span style="background:{% if link.is_active %}rgba(34,197,94,0.2); color:#22c55e;{% else %}rgba(239,68,68,0.2); color:#ef4444;{% endif %} padding:4px 8px; border-radius:4px; font-size:12px;">
                  {% if link.is_active %}Active{% else %}Inactive{% endif %}
                </span>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="4" style="padding:20px; text-align:center; color:var(--muted);">No links yet</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Top Link Creators -->
  <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(280px, 1fr)); gap:20px;">
    <div style="padding:20px; background:rgba(255,255,255,0.04); border:1px solid var(--line); border-radius:12px;">
      <h3 style="margin:0 0 16px;">ğŸ‘¥ Top Link Creators</h3>
      <div style="display:flex; flex-direction:column; gap:12px;">
        {% for user in top_creators %}
          <div style="display:flex; justify-content:space-between; align-items:center; padding:12px; background:rgba(255,255,255,0.02); border-radius:6px;">
            <div>
              <div style="font-weight:500;">{{ user.get_full_name|default:user.username }}</div>
              <div style="color:var(--muted); font-size:12px;">@{{ user.username }}</div>
            </div>
            <span style="background:rgba(59,130,246,0.2); color:#3b82f6; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:bold;">
              {{ user.link_count }} links
            </span>
          </div>
        {% empty %}
          <p style="color:var(--muted);">No creators yet</p>
        {% endfor %}
      </div>
    </div>

    <div style="padding:20px; background:rgba(255,255,255,0.04); border:1px solid var(--line); border-radius:12px;">
      <h3 style="margin:0 0 16px;">â° Recent Links</h3>
      <div style="display:flex; flex-direction:column; gap:12px;">
        {% for link in recent_links %}
          <div style="padding:12px; background:rgba(255,255,255,0.02); border-radius:6px;">
            <div style="display:flex; justify-content:space-between; align-items:start;">
              <div>
                <div style="font-weight:500; margin-bottom:4px;">{{ link.title }}</div>
                <div style="color:var(--muted); font-size:11px;">@{{ link.user.username }}</div>
              </div>
              <span style="color:var(--muted); font-size:11px; white-space:nowrap;">{{ link.created_at|date:"M d" }}</span>
            </div>
          </div>
        {% empty %}
          <p style="color:var(--muted);">No recent links</p>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
